<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excalidraw MVP Generator</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; margin: 0; background-color: #f0f0f0; }
        .container { text-align: center; padding: 2rem; background-color: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        #actionButton { font-size: 1rem; padding: 0.8rem 1.5rem; color: white; background-color: #635bff; border: none; border-radius: 5px; cursor: pointer; text-decoration: none; display: inline-block; }
        #actionButton:disabled { background-color: #ccc; cursor: not-allowed; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Excalidraw MVP</h1>
        <p>Dieses Skript lädt eine lokale JSON-Datei und generiert daraus einen Excalidraw-Link.</p>
        <a id="actionButton" href="#" target="_blank" disabled>Wird geladen...</a>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const actionButton = document.getElementById('actionButton');
            const jsonFileName = 'template.json';

            fetch(jsonFileName)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Netzwerk-Fehler: Konnte ${jsonFileName} nicht laden.`);
                    }
                    return response.json();
                })
                .then(data => {
                    // ================================================================
                    // KORREKTUR HIER:
                    // Wir stringifizieren das GESAMTE 'data'-Objekt, nicht nur die Elemente.
                    // Das 'data'-Objekt aus der JSON-Datei hat bereits die richtige Struktur.
                    const encodedData = encodeURIComponent(JSON.stringify(data));
                    // ================================================================

                    // Den finalen Link zusammenbauen
                    const excalidrawLink = `https://excalidraw.com/#json=${encodedData}`;

                    // Den Button aktualisieren, damit er als Link funktioniert
                    actionButton.href = excalidrawLink;
                    actionButton.textContent = '✅ Board in neuem Tab öffnen';
                    actionButton.removeAttribute('disabled');
                })
                .catch(error => {
                    console.error('Fehler beim Laden oder Verarbeiten der JSON-Datei:', error);
                    actionButton.textContent = '❌ Fehler!';
                    actionButton.style.backgroundColor = '#e03131';
                });
        });
    </script>

</body>
</html>
